# ──────────────────────────────
# Prefix Key and General Setup
# ──────────────────────────────
set-option -g prefix C-n
unbind-key C-n
bind-key C-n send-prefix
set -g base-index 1
set -g pane-base-index 1
setw -g mode-keys vi
set -sg escape-time 0
set -sg repeat-time 0

# ──────────────────────────────
# Plugins via TPM
# ──────────────────────────────
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
run '~/.tmux/plugins/tpm/tpm'

# ──────────────────────────────
# Keybindings - Navigation & Layout
# ──────────────────────────────
bind n display-panes
bind : command-prompt
bind r source-file ~/.tmux.conf \; display-message "Reloaded .tmux.conf"

# Pane movement
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r C-h swap-pane -D
bind -r C-j swap-pane -U
bind -r C-k swap-pane -D
bind -r C-l swap-pane -U

# Resize panes
bind -r i resize-pane -U 5
bind -r u resize-pane -D 5
bind -r y resize-pane -L 5
bind -r o resize-pane -R 5

# Split panes with current dir
bind v split-window -h -c "#{pane_current_path}"
bind x split-window -v -c "#{pane_current_path}"
bind q kill-pane

# ──────────────────────────────
# Windows
# ──────────────────────────────
bind Enter new-window
bind -n M-[ next-window
bind -n M-] previous-window
bind -n M-S-Left swap-window -t -1\; select-window -t -1
bind -n M-S-Right swap-window -t +1\; select-window -t +1

# ──────────────────────────────
# Copy Mode (Vi-style)
# ──────────────────────────────
bind c copy-mode
bind -Tcopy-mode-vi n send-keys -X halfpage-down
bind -Tcopy-mode-vi p send-keys -X halfpage-up
bind -Tcopy-mode-vi v send-keys -X begin-selection
bind -Tcopy-mode-vi y send-keys -X copy-selection
bind -Tcopy-mode-vi Enter send-keys -X copy-selection-and-cancel
bind -Tcopy-mode-vi Escape send-keys -X cancel

# ──────────────────────────────
# Appearance
# ──────────────────────────────
set-option -g status-position bottom
set -g status-style bg=default
set -g status-fg '#cdd6f4'
set -g status-interval 2
set -g status-justify left
set-option -g status-left-length 40
set-option -g status-left ''

# Nerd Font Icons + Status Right
set -g status-right-length 120
set -g status-right-style 'fg=#00af87 bg=default'
set -g status-right "#[fg=#f38ba8]󰻠 #(top -l 1 | grep -E '^CPU' | awk '{print \$3+\$5}')% #[fg=#fab387]󰍛 #(memory_pressure | grep 'System-wide memory free percentage' | awk '{print 100-\$5}')% #[fg=#cba6f7,bold] %H:%M #[fg=#f5c2e7,italics][#S]"

# Pane borders
set -g pane-border-style 'fg=#45475a'
set -g pane-active-border-style 'fg=#f9e2af'

# Window status
setw -g window-status-separator ''
setw -g window-status-current-style 'fg=#f9e2af'
setw -g window-status-style 'fg=#585b70'

setw -g window-status-format ' #{?#{==:#{window_name},zsh},#[fg=#89b4fa]󰞷 ,\
#{?#{==:#{window_name},bash},#[fg=#89b4fa]󰊕 ,\
#{?#{==:#{window_name},nvim},#[fg=#a6e3a1]󰕷 ,\
#{?#{==:#{window_name},vim},#[fg=#a6e3a1]󰕷 ,\
#{?#{==:#{window_name},lazygit},#[fg=#fab387]󰊢 ,\
#{?#{==:#{window_name},htop},#[fg=#f38ba8]󰘚 ,\
#{?#{==:#{window_name},Python},#[fg=#cba6f7]󰌠 ,\
#{?#{==:#{window_name},node},#[fg=#a6e3a1]󰎙 ,\
#{?#{==:#{window_name},ruby},#[fg=#f38ba8]󰴭 ,\
#{?#{==:#{window_name},docker},#[fg=#89b4fa]󰡨 ,\
#{?#{==:#{window_name},go},#[fg=#89dceb]󰟓 ,\
#{?#{==:#{window_name},mysql},#[fg=#f9e2af]󰆼 ,\
#{?#{==:#{window_name},top},#[fg=#f38ba8]󰘚 ,\
#[fg=#cdd6f4]󱂬 }}}}}}}}}}}}}#I '

setw -g window-status-current-format ' #[bold]#{?#{==:#{window_name},zsh},#[fg=#89b4fa]󰞷 ,\
#{?#{==:#{window_name},bash},#[fg=#89b4fa]󰊕 ,\
#{?#{==:#{window_name},nvim},#[fg=#a6e3a1]󰕷 ,\
#{?#{==:#{window_name},vim},#[fg=#a6e3a1]󰕷 ,\
#{?#{==:#{window_name},lazygit},#[fg=#fab387]󰊢 ,\
#{?#{==:#{window_name},htop},#[fg=#f38ba8]󰘚 ,\
#{?#{==:#{window_name},Python},#[fg=#cba6f7]󰌠 ,\
#{?#{==:#{window_name},node},#[fg=#a6e3a1]󰎙 ,\
#{?#{==:#{window_name},ruby},#[fg=#f38ba8]󰴭 ,\
#{?#{==:#{window_name},docker},#[fg=#89b4fa]󰡨 ,\
#{?#{==:#{window_name},go},#[fg=#89dceb]󰟓 ,\
#{?#{==:#{window_name},mysql},#[fg=#f9e2af]󰆼 ,\
#{?#{==:#{window_name},top},#[fg=#f38ba8]󰘚 ,\
#[fg=#cdd6f4]󱂬 }}}}}}}}}}}}}#I '

setw -g window-status-bell-style 'fg=yellow bg=red bold'

# ──────────────────────────────
# Misc Options
# ──────────────────────────────
set -g mouse on
set -g allow-rename on
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
